/*!
 * jSel is “Visual selection of elements for jQuery framework”.
 *
 * @author demorfi <demorfi@gmail.com>
 * @version 1.0
 * @source https://github.com/demorfi/jsel
 * @license http://opensource.org/licenses/MIT Licensed under MIT License
 */
(function(b){b.fn.jsel=function(c){var d=this.data("jselSelf")?a.call(this.data("jselSelf"),this,c):(new a(this,c));this.data("jselSelf",d);return(d.init())};var a=function(d,c){this.version=1;this.options=b.extend(true,{active:false,breakCode:27,borderSize:2,useLabel:true,useEvent:true,events:{},callback:{init:null,select:null},"class":{wrapper:"jsel-wrapper",selector:"jsel-selector",selectionLabel:"jsel-selection-label",selectionEvents:"jsel-selection-events",eventsItems:"jsel-events-items",selectionLeft:"jsel-selection-left",selectionRight:"jsel-selection-right",selectionTop:"jsel-selection-top",selectionBottom:"jsel-selection-bottom"}},c);this.$el=b(d).first();return(this)};a.prototype={init:function(){if(this.$el.length){this.build();this.getOption("useEvent")&&this.buildEvents();this.getOption("active")&&this.setActive();this.setOption("useEvent",!b.isEmptyObject(this.getOption("events")));this.getCallback("init").call(this,this.$el)}return(this)},build:function(){if(!this.$el.find(this.getClass("wrapper",true)).length){this.$wrap=b("<div>").addClass(this.getClass("wrapper")).append(b("<div>").addClass(this.getClass("selectionLabel"))).append(b("<div>").addClass(this.getClass("selectionEvents"))).append(b("<div>").addClass(this.getClass("selectionLeft"))).append(b("<div>").addClass(this.getClass("selectionRight"))).append(b("<div>").addClass(this.getClass("selectionTop"))).append(b("<div>").addClass(this.getClass("selectionBottom"))).appendTo(this.$el)}},buildEvents:function(){if(this.$wrap&&!this.$wrap.find(this.getClass("eventsItems",true)).length){b("<ul>").addClass(this.getClass("eventsItems")).appendTo(this.$wrap.find(this.getClass("selectionEvents",true)));this.$el.on("click.jselEvents",b.proxy(function(g){var f=b(g.target);if(f.hasClass(this.getClass("selectionEvents"))){f.find(this.getClass("eventsItems",true)).show()}else{this.$el.find(this.getClass("eventsItems",true)).hide()}},this))}var c=this.$el.find(this.getClass("eventsItems",true)).empty(),d=this.getOption("events");for(var e in d){if(d.hasOwnProperty(e)){b("<li>").attr("id","jselEvent-"+e).html(d[e].label).on("click.jselEvent",b.proxy(function(g,f){g.call(this,this.$selected,f)},this,d[e].callback)).appendTo(c)}}},getClass:function(d,c){if(d.indexOf(" ")!==-1){return(d.split(" ").map(b.proxy(function(e){if(e.length){return(this.getClass(e,c))}},this)).join(c?",":" "))}return((c?".":"")+this.options["class"][d])},getCallback:function(c){return(b.isFunction(this.options.callback[c])?this.options.callback[c]:b.noop)},getOption:function(c){return(this.options[c])},setOption:function(c,d){this.options[c]=d},getVersion:function(){return(this.version)},setActive:function(){this.$el.addClass(this.getClass("selector")).on({"mousemove.jselPos":b.proxy(this.setPosition,this),"click.jselSelect":b.proxy(this.selectElement,this),"keyup.jselBreak":b.proxy(this.breakSelect,this)}).find(this.getClass("wrapper",true)).show()},setInactive:function(){this.$el.off("mousemove.jsel click.jsel keyup.jsel").find(this.getClass("wrapper",true)).hide();this.breakSelect()},hasSelected:function(c){return(this.$selected||c.closest(this.getClass("wrapper",true)).length)},selectElement:function(d){var c=b(d.target);if(!this.hasSelected(c)){this.$selected=c;this.getOption("useEvent")&&this.$el.find(this.getClass("selectionEvents",true)).show()}},breakSelect:function(c){if(!c||c.keyCode===this.getOption("breakCode")){delete this.$selected;this.$el.find(this.getClass("selectionEvents",true)).hide()}},setPosition:function(g){var e=b(g.target);if(!this.hasSelected(e)){var f=this.getOffsetCalc(e),d="["+Math.round(e.innerWidth())+"x"+Math.round(e.innerHeight())+"px]";if(this.getOption("useLabel")){var h=this.$el.find(this.getClass("selectionLabel",true)).text(this.getSelector(e)+" "+d).css({left:f.leftMin,"max-width":f.widthMax}).show();var i=f.top-h.innerHeight()-f.border;h.css({top:i>=1?i:f.top})}var c=this.$el.find(this.getClass("selectionEvents",true));c.css({left:f.leftMax,top:f.topMin});this.$el.find(this.getClass("selectionLeft selectionRight",true)).css({height:f.height,width:f.border,left:f.leftMin,top:f.top}).filter(this.getClass("selectionRight",true)).css("left",f.leftMax);this.$el.find(this.getClass("selectionTop selectionBottom",true)).css({height:f.border,width:f.widthMax,left:f.leftMin,top:f.topMin}).filter(this.getClass("selectionBottom",true)).css("top",f.topMax);this.getCallback("select").call(this,this.$el,e)}},getOffsetCalc:function(c){var d={border:this.getOption("borderSize"),width:c.innerWidth(),height:c.innerHeight(),left:c.offset().left,top:c.offset().top};d.borderMax=d.border*2;d.widthMax=d.width+d.borderMax;d.leftMin=d.left-d.border;d.leftMax=d.left+d.width;d.topMin=d.top-d.border;d.topMax=d.top+d.height;return(d)},getSelector:function(c){var d=c.parents().add(c).map(function(){var e=this.tagName.toLowerCase();if(e!=="body"&&e!=="html"){e+=(this.id?("#"+this.id):"")+(this.className?("."+b.trim(this.className.replace(/\s/gi,"."))):"")+(":nth-child("+(b(this).index()+1)+")");return(e)}}).get().join(" > ");return(d)}};b(function(){b(".jsel-trigger").jsel({active:true})})})(jQuery);